--- 
title: <span style="color:#003300;">Manual para la identificación de los hotspots en áreas úrbanas</span>
author: <span style="color:#003300;">Felipe Antonio Dzul Manzanilla</span>
date: "2021: Last compiled `r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
biblio-style: apalike
link-citations: yes
github-repo: fdzul/manual_hotspots
cover-image: images/cover.jpg
url: https://fdzul.github.io/manual_hotspots/
favicon: "favicon.ico"
description: "El manual describe la identificación de los hotspots en áreas endemicas de dengue en México"
---

#  **<span style="color:#003300;">Welcome</span>** {-}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;">Este documento es la versión en línea del bookdown</span><span style="color:#003300;"> **Manual para la Identificación de los hotspots del dengue en áreas urbanas de México en R**</span><span style="color:#660033;">, es un libro diseñado para desarrollar las competencias específicas para la identificación de los hotspots del dengue en áreas urbanas y metropolitanas de México.</span>

<a href=""><img src="images/cover.jpg" width="550" height="550" alt="" align="right" style="margin: 0 1em 0 1em" /></a>
  

<span style="color:#660033;">La concepción teórica y práctica del libro es inspirado por la urgente necesidad de contribuir en políticas públicas y toma de desiciones del Programa de Prevención y Control de las Arbovirosis en México, específicamente en el diseño, implementación y escalamiento de un modelo estratégico de focalización del dengue en las areas urbanas y metropolitanas de México usando análisis espaciales (hotspots analysis, space-time analysis, geostatistical analysis) de la vigilancia epidemiológica y entomológica generada por el programa.</span>


<span style="color:#660033;">La publicación online es inspirada por las iniciativas libres para la publicación de textos como 
[**bookdown**](https://github.com/rstudio/bookdown) & todas las inciciativas de software libre para el análisis de datos espaciales y no espaciales como [**R**](https://cran.r-project.org/), [**RStudio**](https://www.rstudio.com/) y [**Python**](https://www.python.org/). El libro es de codigo abierto, asegurando que su contenido es completamente reproducible y públicamente disponible para personal de la Secretaría de Salud de México.</span>


<span style="color:#660033;">La versión online del manual es mantenida en [fdzul.github.io/manual_hotspots](https://fdzul.github.io/manual_hotspots/) & es actualizada [GitHub Actions](https://github.com/fdzul/manual_hotspots/actions), la cual proporciona información sobre el estatus 'build status' con:
![](https://github.com/fdzul/manual_hotspots/actions/workflows/blank.yml/badge.svg) ![](https://app.fossa.com/api/projects/git%2Bgithub.com%2Ffdzul%2Fmanual_hotspots.svg?type=shield)
</span>


<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;">**Note**: El manual no ha sido publicado en físico por ninguna editorial y los autores están de acuerdo en llegar a un trato con una editorial.</span>


# **<span style="color:#003300;">Prologo</span>**{-}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

# **<span style="color:#003300;">Justificación</span>**{-}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;">El programa de prevención y control del dengue en México se enfrenta a grandes desafíos que incluyen:</span>

 - <span style="color:#660033;">Expanción geográfica del dengue.</span>
 
 - <span style="color:#660033;">Incremento de la transmisión en zonas endémicas y no endémicas.</span>
 
 - <span style="color:#660033;">Presencia de brotes en zonas urbanas que contituyen grandes metropolis (Guadalajara, Monterrey, La comarca Lagunera, etc).</span>
 
 - <span style="color:#660033;">Potencial introducción de nuevos agentes causales, como la Fiebre Amarilla y Mayaro.</span>


<span style="color:#660033;">El desarrollo de un modelo estratégico de focalización de las acciones antivectoriales en las áreas urbanas endémicas de México y su implementación, constituye un elemento clave para redirigir los límitados recursos materiales, humanos y económicos a las áreas de los grandes centros urbanos donde la transmisión se concentra (basados en datos históricos) y donde las cadenas de transmisión son activas (datos actuales). Teóricamente, de acuerdo a la Power Law 80:20 conocida como principio o ley de Pareto 80/20, sí el 80% de la transmisión se concentra en el 20% del área urbana, por lo tanto la focalización de las acciones en el 20% del área, permitiría obtener reducciones del 80% de la carga de la enfermedad.</span>

# **<span style="color:#003300;">Software & Convenciones</span>** {-}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;">Con el advenimiento de la era del internet, la exponencial la capacidad de las computadoras (software and hardware) y la creciente la disponibilidad software libre para el análisis espacial, ha permitido que más investigadores tengan acceso a las herramientas analíticas. En el top ten para el análisis de datos espaciales, se observan a [QGIS](http://www.qgis.org/es/site/ ), **[R](https://cran.r-project.org/)**, [Python](https://www.python.org/), [GeoDa](https://spatial.uchicago.edu/software), [SaTScan](https://www.satscan.org/) y [GRASS](https://grass.osgeo.org/). Actualmente, existe una tendencia a usar R o Python para el análisis espacial. Entre las principales limitantes de ambos lenguajes de programación es que la curva de aprendizaje es lenta y tortuosa. No obstante, lo anterior, cada día más personas están usando ambos lenguajes para el análisis espacial.</span>

<span style="color:#660033;">En el presente manual se usará **[R](https://cran.r-project.org/)** y **[RStudio](https://www.rstudio.com/)** para el cálculo de los hotspots. El manual asume que los usuarios tienen experiencia en el uso de R, RStudio y que cuentan con su clave API del servicio de geocodificacion de google ([Geocoding API de google](https://developers.google.com/maps/documentation/geocoding/overview)). **[R](https://cran.r-project.org/)** es un programa de computadora estadístico que proporciona un ambiente rico y variado para la visualización y análisis de datos (espaciales y no espaciales). **[R](https://cran.r-project.org/)** se baja gratis del website de Comprensive R Archive Network en https://cran.r-project.org/ y es distribuido con una licencia pública general (GBU). Lo ideal es usar la consola de **[R](https://cran.r-project.org/)**, pero es ampliamente recomendado utilizar un ambiente de desarrollo integrado (IDE, integrated development enviroment) para interactuar con **[R](https://cran.r-project.org/)**, como **[RStudio](https://www.rstudio.com/)**. **[RStudio](https://www.rstudio.com/)** se baja gratis en la página de RStudio https://rstudio.com/products/rstudio/.</span>


<span style="color:#660033;">Los análisis hotspots con el estadístico espacial local Getis&Ord ($G_{i}^{*}$) tanto para los datos históricos de los casos y del vector (ovitrampas), así como **Space-Time análisis** con **[SaTScan](https://www.satscan.org/)** y **[ClusterSeer](https://www.biomedware.com/software/clusterseer/)** son implementados en **[R](https://cran.r-project.org/)** y se desarrollaron los siguientes paquetes para facilitar su implementación en los servicios de salud de México.</span>

* **[denhotspots](https://github.com/fdzul/denhotspots)**
* **[deneggs](https://github.com/fdzul/deneggs)**
* **[rgeomex](https://github.com/fdzul/rgeomex)**
* **[dendata](https://github.com/fdzul/dendata)**

<span style="color:#660033;">Los paquetes se instalan en la consola de **[R](https://cran.r-project.org/)** o **[RStudio](https://www.rstudio.com/)** en tecleando lo siguiente:</span>

```{r, warning=FALSE, error=FALSE, message=FALSE}
#devtools::install_github("fdzul/denhotspots")
#devtools::install_github("fdzul/deneggs")
#devtools::install_github("fdzul/rgeomex")
#devtools::install_github("fdzul/dendata")
```
ó
```{r,warning=FALSE, error=FALSE, message=FALSE}
#remotes::install_github("fdzul/denhotspots")
#remotes::install_github("fdzul/deneggs")
#remotes::install_github("fdzul/rgeomex")
#remotes::install_github("fdzul/dendata")
```

<span style="color:#660033;">Por convención en el texto los paquetes se proporcionaran en negrita y azul marino (ejemplo **[denhotspots](https://github.com/fdzul/denhotspots)**). Las funciones puedes referirse individualmente (**[extract_ageb]()**) o a través de su paquete (***[rgeomex::extract_ageb]()***) en cursiva y color azul marino. En el caso de ***[denhotspots::gihi]()***, **[denhotspots]()** es el paquete y ***[gihi]()*** es la función. En los códigos las funciones de los paquetes **[denhotspots](https://github.com/fdzul/denhotspots)**,**[deneggs](https://github.com/fdzul/deneggs)**, **[rgeomex](https://github.com/fdzul/rgeomex)** y **[dendata](https://github.com/fdzul/dendata)** usaran este metodo de applicar la función atravez de ***:*** debido a que evita conflictos con otros paquetes que tienen funciones con el mismo nombre pero que realizan diferente función.</span>

<span style="color:#660033;">Como el documento incluye texto y código, el código estara cirscunscrito en un recuadro con fondo <span style="color:#567482">gris</span> como  acontinuación se presenta. El símbolo **#** indica un comentario del código, no tiene efecto en R y como resultado no se correrá la pieza del código.</span>

```{r,warning=FALSE, error=FALSE, message=FALSE}
#devtools::install_github("fdzul/denhotspots")
```

<span style="color:#660033;">En el código (recuadro gris) a las funciones se les asignará un color **<span style="color:#06287e">azul</span>**, a los paquetes un color **<span style="color:#567482">gris</span>**, a los **argumentos** de la funciones se les asignará un color **<span style="color:#7d9029">verde</span>** y a los **valores** de los argumentos se les asignará un color **<span style="color:#06287e">azul</span>**.</span>

```{r, warning=FALSE, error=FALSE, message=FALSE}
library(sf)
library(magrittr)
gua <- rgeomex::extract_ageb(locality = c("Zapopan", "Tonalá",
                                          "Tlaquepaque", "Guadalajara"),
                             cve_geo = "14")
```

```{r, warning=FALSE, error=FALSE, message=FALSE}
plot(sf::st_geometry(gua$locality))
```

# **<span style="color:#003300;">Estructura de Manual</span>**{-}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;"> El manual incluye tres análisis espaciales, un análisis para datos espaciales de área (areal analysis) con el estadístico espacial local $G{_i}^{*}$, tres análisis para datos espaciales de patron de puntos espaciales (point pattern), dos son conocidos como space-time analysis y son realizados con los estadísticos satscan statistics & knox test y el tercer análisis utiliza un modelo log-Gaussian Cox process.
El libro incluye cinco secciones o apartados, una sección para la introducción y el objetivo del libro, y un apartado para cada análisis, que incluye un capítulo donde se describe el algoritmo y un capítulo donde se implementa en el lenguaje de programación de [**R**](https://cran.r-project.org/).</span>

# **<span style="color:#003300;">Agradecimientos</span>**{-}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;"> El presente manual fue producido por personal de vectores y la Subdirección de Salud Publica de la [Secretaría de Salud del Estado de Veracruz](https://www.ssaver.gob.mx/) en colaboración con la Subdirección del Programa Nacional de Vectores del [Centro de Nacional de Programas Preventivos y Control de Enfermedades](https://www.gob.mx/salud/cenaprece) y el Laboratorio de Entomología del [Instituto de Diagnóstico y Referencia Epidemiológicos](https://www.gob.mx/salud/acciones-y-programas/instituto-de-diagnostico-y-referencia-epidemiologicos-indre) de la [Secretaría de Salud Federal](https://www.gob.mx/salud). </span>


<span style="color:#660033;"> Los autores agradecen a la [Secretaría de Salud del Estado de Veracruz](https://www.ssaver.gob.mx/), al [Centro de Nacional de Programas Preventivos y Control de Enfermedades](https://www.gob.mx/salud/cenaprece) y el [Instituto de Diagnóstico y Referencia Epidemiológicos](https://www.gob.mx/salud/acciones-y-programas/instituto-de-diagnostico-y-referencia-epidemiologicos-indre) de la [Secretaría de Salud Federal](https://www.gob.mx/salud) por las facilidades otorgadas para poder desarrollar la presente iniciativa. </span>


<!--chapter:end:index.Rmd-->

# (PART) Sección {-}

# **<span style="color:#003300;">Introducción </span>** {#intro}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;">Los hotspots de las arbovirosis transmitidas por Aedes aegypti son definidas como aquellas áreas donde se concentra la mayor carga de la transmisión de los virus del dengue, chikungunya y/o zika (Bisanzio et al 2017; Dzul-Manzanilla et al 2021). Actualmente, los hotspots son la principal estrategia de identificación de las áreas de riesgo en el interior de los grandes centros urbanos endémicos de dengue y es ampliamente recomendada por la Organización Panamericana de de la Salud (2019) y grupos científicos (Vanlerberghe et al., 2017;  Olliaro et al., 2018 Roiz et al., 2019).</span>

<span style="color:#660033;">Los procedimientos y cálculos en los respectivos programas (GeoDA, ArcView, ArcGis, R y Python) es completemente restrictivo a la comunidad científica y grupos académicos con expertis. La operacionalización de los algoritmos para la identificación de los hotspots en los programas de salud en México, es el paso siguiente que se requiere para que la estrategía de focalización de los hotspots se escale en todo el país.</span>

<span style="color:#660033;">En el presente manual se describen los pasos lógicos para la identificación de los hotspots de los casos de dengue y los hotspots de la abundancia el vector usando bases de datos históricas y bases de datos recientes. Así mismo, se describe la identificación de cluster de transmisión y la identificación de las cadenas  de transmisión. Todos los análisis espaciales son implementados en R.</span>

<!--chapter:end:01-intro.Rmd-->

# **<span style="color:#003300;"> Objetivo </span>** {#objetivos}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019"> 

<span style="color:#660033;">I.	Unificar y estandarizar los criterios, instrumentos, y cálculos que se requieren para la identificación de los hotspots en las áreas urbanas endémicas de dengue en México.</span>

<span style="color:#660033;">II. Unificar y estandarizar los criterios, instrumentos, y cálculos que se requieren para identificación de las cadenas de transmisión en las áreas urbanas endémicas de dengue en México.</span>


<span style="color:#660033;">III. Unificar y estandarizar los criterios, instrumentos, y cálculos que se requieren para identificación de los clusters de transmisión en las áreas urbanas endémicas de dengue  en México.</span>

<span style="color:#660033;">El manual para la identificación de los hotspots en las localidades urbanas endémicas no solo está dirigido al personal operativo, mandos medios y directivos de los Programas de Prevención y Control de las arbovirosis transmitidas por ***Aedes*** de la Secretaria de Salud de México, sino también a la comunidad académica relacionada con la investigación operativa sobre los hotspots de dengue y al público en general interesado en el tema.</span>

<!--chapter:end:02-objetivos.Rmd-->


# (PART) Sección {-}
# **<span style="color:#003300;">Hotspots</span>** {#hotspots}

Placeholder


## **<span style="color:#003300;">Análisis de la Información epidemiológica y entomológica</span>**
## **<span style="color:#003300;">Hotspots de transmisión histórica</span>**
### <span style="color:#003300;">Algoritmo para el cálculo de los Hotspots</span>
### **<span style="color:#003300;">Referencias</span>**

<!--chapter:end:03-hotspots.Rmd-->


# **<span style="color:#003300;">Hotspots en R</span>** {#hotspotsr}

Placeholder


## **<span style="color:#003300;">Bajar las bases de datos del [SINAVE](https://www.sinave.gob.mx/).</span>**
### **<span style="color:#660033;">Escribir en el buscador de preferencia la página del sinave (https://www.sinave.gob.mx/).</span>**
### **<span style="color:#660033;">En la página del sinave buscar y darle click al boton Enfermedades Transmitidas por Vector.</span>**
### **<span style="color:#660033;">Ingresar el nombre del usurio y contraseña.</span>** 
### <span style="color:#660033;">Ingresar a la sección de **Reportes**.</span> 
### <span style="color:#660033;">Darle click a **Descarga de Datos Vectores**</span> 
### **<span style="color:#660033;">Bajar la base de datos de la última fecha de la enfermedad de interés.</span>** 
### **<span style="color:#660033;">Guardar la base en la carpeta de interes.</span>** 
### **<span style="color:#660033;">Extraer el txt del archivo con extensión RAR.</span>** 
## **<span style="color:#003300;">Geocodificación de la base de datos de Dengue.</span>**
### **<span style="color:#660033;">Subir la base de datos de Dengue a</span>**  ![](https://d33wubrfki0l68.cloudfront.net/62bcc8535a06077094ca3c29c383e37ad7334311/a263f/assets/img/logo.svg){width=10%}
#### **<span style="color:#660033;">Subir la base de datos de dengue de la semana actual.</span>** 
#### **<span style="color:#660033;">Subir la base de datos de dengue de la semana pasada</span>** 
#### **<span style="color:#660033;">Ordenar la base por el ID del paciente y extraer los casos no geocodificados de la semana actual.</span>**
#### **<span style="color:#660033;">Guardar el resultado</span>** 
#### **<span style="color:#660033;">head(), dim() y names()</span>** 
### **<span style="color:#660033;">Subir el csv a</span>**  ![](https://d33wubrfki0l68.cloudfront.net/62bcc8535a06077094ca3c29c383e37ad7334311/a263f/assets/img/logo.svg){width=10%} **<span style="color:#003300;">y creamos el vector de direcciones</span>**
### **<span style="color:#660033;">Realizar la geocodificación</span>** 
#### **<span style="color:#660033;">manipulación de texto</span>** 
#### **<span style="color:#660033;">Geocodificación.</span>** 
###  **<span style="color:#660033;">Guardar la información en RData</span>** 
#### **<span style="color:#660033;">Subir la base geocodificada</span>** 
#### **<span style="color:#660033;">Subir la base de casos</span>** 
#### **<span style="color:#660033;">Eliminar duplicados y guardar</span>** 
## **<span style="color:#003300;">Bajar los shapefile del [INEGI](https://www.inegi.org.mx/).</span>**
## **<span style="color:#003300;">Contar el número de casos por AGEB (agregación espacial).</span>** 
### **<span style="color:#660033;">subir la base datos geocodificada.</span>** 
### **<span style="color:#660033;">subir los AGEBs.</span>** 
### **<span style="color:#660033;"> Realizar la agregación espacial.</span>**
## **<span style="color:#003300;">Pasos 6-10. Cálcular el Z-score de los casos a Calcular los hotspots.</span>** 
## **<span style="color:#003300;">Visualizar los hotspots.</span>**  

<!--chapter:end:04-hotspotsr.Rmd-->


# (PART) Sección {-}
# **<span style="color:#003300;">Clusters de transmisión </span>** {#clusters}

Placeholder


## <span style="color:#003300;">**Identificación de clusters de transmisión**</span>
## <span style="color:#003300;">Algoritmo para **Space-Time análisis** con **[SaTScan](https://www.satscan.org/)**</span>

<!--chapter:end:05-clusters.Rmd-->


# **<span style="color:#003300;">Clusters de Transmisión en R</span>** {#clustersr}

Placeholder


## **<span style="color:#003300;">Identificación de los cluster de transmisión en R</span>**
## **<span style="color:#003300;">Generar los archivos cas y geo</span>**.
### **<span style="color:#003300;">Paso 1. Subir la base de datos geocodificada</span>**.
### **<span style="color:#003300;">Paso 2. Subir las funciones </span>**.
### **<span style="color:#003300;">Paso 3. Aplicar las funciones</span>**.
## **<span style="color:#003300;">Definir los parametros del input, análisis y resultado (output).</span>**

<!--chapter:end:06-clustersr.Rmd-->


# (PART) Sección {-}
# **<span style="color:#003300;">Cadenas de Transmisión</span>** {#cadenas}

Placeholder


## <span style="color:#003300;">**Space-Time con Knox test**</span>
## **<span style="color:#003300;">Algorítmo para realizar la prueba de knox</span>**

<!--chapter:end:07-cadenas.Rmd-->


# **<span style="color:#003300;">Cadenas de Transmisión en R</span>** {#cadenasr}

Placeholder


## **<span style="color:#003300;">Identificación de cadenas de transmisión en R</span>**
## **<span style="color:#003300;">Knox test</span>**
### **<span style="color:#003300;">Visualización de las cadenas de Transmisión </span>** 
#### **<span style="color:#003300;">Mapa estático</span>** 
#### **<span style="color:#003300;">Mapa interactivo</span>**
#### **<span style="color:#003300;">Mapa estático en paneles por grupos de semanas</span>**

<!--chapter:end:08-cadenasr.Rmd-->

# (PART) Sección {-}

# **<span style="color:#003300;">Log Gaussian Cox Process Espacial</span>** {#lgcp}



## <span style="color:#003300;">**LGCP espacial**</span>

## **<span style="color:#003300;">Algorítmo para realizar el LGCP espacial </span>**


<span style="color:#660033;">1. Bajar la base de casos de la plataforma del SINAVE.</span>

<span style="color:#660033;">2. Subir la base en R y extraer la información relevante.</span>

<span style="color:#660033;">3. Geocodificar las direcciones de residencia de los casos. </span>

<span style="color:#660033;">4. Generar los archivos RData con las columnas onset y coordenadas geográficas (latitud y longitud).</span>

<span style="color:#660033;">5. Aplicar el análisis LGCP espacial con la función **[denhotspots::spatial_lgcp]()**.</span>

<span style="color:#660033;">6. Visualizar el análisis LGCP espacial.</span>


<!--chapter:end:09-lgcp.Rmd-->


# **<span style="color:#003300;">Log Gaussian Cox Process Espacial en R</span>** {#lgcpr}

Placeholder


## **<span style="color:#003300;">LGCP Espacial en R</span>**

<!--chapter:end:10-lgcpr.Rmd-->

